{% extends "base.html" %}

{% block extended_css %}
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css"
          integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css"
          integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
    <link rel="stylesheet" href="/static/css/createvote_style.css">
{% endblock %}

{% block content %}
    <div class="sub_container">
        <div class="row">
            <div class="col text-center">
                <h1 id="title">
                    Creating a poll
                </h1>
            </div>
        </div>
        <div class="row">
            <form method="post" id = "poll-form">
                <div class="form-group">
                    <label class = "p_label">Question: </label>
                    <input type="text" class="text_field form-control" id="question_field"
                           placeholder="Specify the question">
                </div>
                <div class="form-group clearfix">
                    <label class="p_label types_label float-left">Type of
                        responses: </label>
                    <br>
                    <div class="btn-group btn-group-toggle float-left" data-toggle="buttons">
                        <label class="btn btn-secondary active">
                            <input type="radio" name="options" id="option1" autocomplete="off" checked> 1 of the list
                        </label>
                        <label class="btn btn-secondary">
                            <input type="radio" name="options" id="option2" autocomplete="off"> Several of the list
                        </label>
                        <label class="btn btn-secondary">
                            <input type="radio" name="options" id="option3" autocomplete="off"> Rating
                        </label>
                    </div>
                </div>


                <div class="form-group">
                    <label class = "p_label">Open to: </label>
                    <label class="p_label float-left" style="width: 60px; margin-top: 7px;margin-right: 5px;">Date: </label>
                    <input name="datetime" id="datepicker" type="date"  class="text_field form-control float-left" style="width: 200px;">
                    <label class="p_label float-left" style="width: 60px; margin-left: 20px; margin-top: 7px; margin-right: 5px;">Time: </label>
                    <input name="datetime" id="timepicker" type="time"  class="text_field form-control float-left" style="width: 150px;">
                </div>

                <div class="form-group">
                    <label class="p_label">Answers: </label>
                    <div id="answer_items">
                        <div id="answer_element_0">
                            <input type="text"
                                   class="answers_fields text_field form-control float-left answers_elements"
                                   id="formGroupAnswerInput" placeholder="Specify the answer">
                            <button type="button" class="btn btn-danger btn_delete answers_elements" id="del_btn_0"
                                    delete_number="0"><i class="fas fa-trash"></i></button>
                        </div>
                        <div id="answer_element_1">
                            <input type="text"
                                   class="answers_fields text_field form-control float-left answers_elements"
                                   id="formGroupAnswerInput" placeholder="Specify the answer">
                            <button type="button" class="btn btn-danger btn_delete answers_elements" id="del_btn_1"
                                    delete_number="1"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <button type="button" class="btn btn-danger" id="btn_add"><i class="fas fa-plus"></i></button>
                    <button type="submit" class="btn btn-danger" id="btn_save"><i class="fas fa-save"></i></button>
                </div>
            </form>
        </div>
    </div>
{% endblock %}


{% block extended_js %}
    <script src="https://code.jquery.com/jquery-3.3.1.js"
            integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js"
            integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut"
            crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js"
            integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k"
            crossorigin="anonymous"></script>
    <script src="/static/js/create_vote.js"></script>
    <script>
        $(document).ready(function() {
               $("#poll-form").submit(function(event){
                    let date = document.getElementById("datepicker").value;
                    let time = document.getElementById("timepicker").value;
                    let question = document.getElementById("question_field").value;
                    let options = document.getElementsByClassName("answers_fields");
                    let vote_counts = "";
                    let str_options = "";
                    for(let i = 0; i < options.length; i++) {
                        str_options += options[i].value
                        vote_counts += "0"
                        if(i != options.length-1){
                            str_options += String.fromCharCode(6);
                            vote_counts += String.fromCharCode(6);
                        }
                    }
                    let type = -1;
                    var radios = document.getElementsByName('options');
                    for (let i = 0; i < radios.length; i++) {
                        if (radios[i].type == "radio" && radios[i].checked) {
                            type = i;
                            break;
                        }
                    }
                    $.ajax({
                         type:"POST",
                         url:"/create_vote/",
                         data: {
                                 csrfmiddlewaretoken: '{{ csrf_token }}',
                                'question': question,
                                'options': str_options,
                                'type': ['o','s','d'][type],
                                'date': date,
                                'time': time,
                                'vote_counts': vote_counts,
                                }
                    });
                    alert("Данные успешно занесены в БД");
                    return false;
               });
            });
    </script>
{% endblock %}